# ðŸ§  KRONÃ˜S SYNC: MASTER SYSTEM CONTEXT

> **Target Audience:** AI Agents, Developers, Technical Architects.  
> **Purpose:** Deep technical overview of the Kronos Sync architecture, logic, and ecosystem.

---

## ðŸ›°ï¸ 01. CORE PHILOSOPHY: "ELITE SOVEREIGNTY"

KRONÃ˜S SYNC is architected as a **Professional-First Operating System** for tattoo studios. The primary goal is to provide surgical management for professionals while maintaining a frictionless, guest-first experience for clients.

### **The Two-Tier Access Model**
1.  **Professional Layer (Authenticated):** Restricted to verified Team Members (Artists/Admins). Access is guarded by a strict **Professional Gate**.
2.  **Client Layer (Guest):** Frictionless interaction. Clients never create accounts. Data is stored in context-specific buckets (KioskEntry, Booking, Order) and scoped to the studio's workspace.

---

## ðŸ”’ 02. AUTHENTICATION & THE PROFESSIONAL GATE

### **LÃ³gica de SeguranÃ§a (Implemented in `src/lib/auth-options.ts`)**
- **Magic Link System:** Uses a 6-digit verification code sent via **Resend**.
- **The Gate Logic:**
    - If user exists and role is `ARTIST` or `ADMIN` â†’ **ALLOW ACCESS**.
    - If user does not exist:
        - Must have a valid `inviteCode` in the URL/Credentials.
        - System validates invite (active? uses available? expired?).
        - System creates/upgrades user to `ARTIST` role and creates their profile.
    - If neither condition is met â†’ **ACCESS DENIED** (Strictly forbids account creation for non-invited clients).

### **Invite System (`Prisma Model: InviteCode`)**
- Can be generated by Admins.
- Scoped to a specific `workspaceId`.
- Defines `targetPlan` (RESIDENT/GUEST) and optional `durationDays`.

---

## ðŸ—ï¸ 03. ARCHITECTURAL MODULES

### **1. Management Dashboard (`/artist/*`)**
- High-level metrics visualization.
- Google Calendar integration for schedule synchronization.
- Artist profile and portfolio management.

### **2. Financial Vault (`Settlements System`)**
- **Business Rule:** 100% of the value usually goes to the Artist; the Artist then settles commission with the Studio.
- **Settlement Process:**
    - Artist selects completed bookings/orders.
    - Artist transfers PIX to studio.
    - Artist uploads proof (AI-validated).
    - Admin approves/rejects.

### **3. The Link (Kiosk Experience - `/kiosk`)**
- **Lead Capture:** Specifically designed for companions (Ink Pass).
- **Gamification:** 10% OFF coupon generation based on name (`TATTOO10_NAME`).
- **Artist PIN Integration:** Validates the session with the artist actually present in the room (last 4 digits of artist phone).

### **4. Marketplace (`Store Module`)**
- Flash Tattoos and Products.
- Handles custom shares between Artist and Studio per product.
- **Logic:** Integrated with the Financial Settlement flow.

### **5. Anamnesis & Safety**
- Dynamic medical/consent forms.
- Bound to specific `BookingId`.
- Stored as specific context data, not global user data.

---

## ðŸ“Š 04. DATABASE SCHEMA OVERVIEW (CRITICAL)

### **Identity & Team**
- `User`: Global identifier. Role defines boundary (`ADMIN`, `ARTIST`, `CLIENT`).
- `Artist`: Professional profile linked to `User`.
- `InviteCode`: The key to the Professional Gate.

### **Operations**
- `Workspace`: The studio container. All operations are scoped here.
- `Booking`: The core appointment entity.
- `Order`: Marketplace transactions.
- `KioskEntry`: Lead generation bucket (Companion flow).

### **Finance**
- `Settlement`: Tracks financial accountability between Artist and Studio.
- `Product`: Marketplace items (Flash/Merch).

---

## ðŸ› ï¸ 05. TECHNICAL STACK & CONSTRAINTS

- **Framework:** Next.js 15 (App Router).
- **ORM:** Prisma (PostgreSQL).
- **Communication:** Resend (Email).
- **Style:** Tailwind CSS v4 (Custom Cyber-Minimalist Theme).
- **Rules:**
    - Strictly use Server Actions for mutations.
    - All queries must be scoped by `workspaceId` or `userId`.
    - Client components must be minimalist; heavy logic in Server Components.

---

## ðŸš§ 06. RECENT DECISIONS & "DEPRECATIONS"

1.  **Deprecation of Client Login:** We stopped allowing clients to create accounts in the `User` table. Login is now exclusively a "Staff Channel".
2.  **Emergency Logging:** Added `console.log` for auth codes to handle "Sandbox Mode" restrictions on the email provider during domain verification.
3.  **Artist Shares:** Restored complex calculation loops in `store.ts` to ensure financial accuracy across products with varying commissions.

---

## ðŸ”® 07. FUTURE ROADMAP (AI CONTEXT)

- **Phase 1 (Sync):** Global WhatsApp notification engine.
- **Phase 2 (BI):** Multi-workspace admin dashboard for franchises.
- **Phase 3 (AI):** Image recognition for automated anamnesis analysis.

---

> **KRONÃ˜S SYNC** - *Developed by SH1W4 // Optimized for AI Interoperability.*
